function Conjunto(e,r){this.nome=e,this.elementos=r}function Sincronia(e){this.id=e,this.regras=[]}function RegraAmbigua(e){this.regras=e}function getFileFromServer(e,r,a){function t(){r(this.responseText,a)}var i;i=new XMLHttpRequest,i.onload=t,i.open("GET",e,!0),i.send()}function Cadeia(e){if(this.str=Cadeia.EMPTY_CHAR,this.silabaTonicaIdx=-1,void 0!=e)for(var r=0;r<e.length;r++)this.str+=e[r],e[r].tonica&&(this.silabaTonicaIdx=r),r<e.length-1&&(this.str+=Cadeia.SILABA_CHAR);this.str+=Cadeia.EMPTY_CHAR,this.index=0}function Silaba(e){this.str=e,this.tonica=!1}function Regra(e,r){this.origem=e,this.patternCore="",this.tonicidade=Regra.TIPOS.QUALQUER;for(var a="",t=0;t<this.origem.length;t++){var i=this.origem[t];switch(i){case Regra.CJ_START:if("undefined"!=typeof _conjuntos){var n=t,o=n+this.origem.substr(n).search(Regra.CJ_END),s=this.origem.slice(n+1,o),g=_conjuntos[s],l=""+g;l=l.replace(new RegExp(",","g"),""),a+="["+l+"]",t=o}break;case Regra.ATONA:this.tonicidade=Regra.TIPOS.ATONA;break;case Regra.TONICA:this.tonicidade=Regra.TIPOS.TONICA;break;case Regra.PRETONICA:if(t+1<this.origem.length){var c=this.origem[t+1];c==Regra.IMEDIATA?(this.tonicidade=Regra.TIPOS.PRETONICAIMEDIATA,t+=1):c==Regra.PRETONICA?(this.tonicidade=Regra.TIPOS.PRETONICANAOIMEDIATA,t+=1):this.tonicidade=Regra.TIPOS.PRETONICA}else this.tonicidade=Regra.TIPOS.PRETONICA;break;case Regra.POSTONICA:if(t+1<this.origem.length){var c=this.origem[t+1];c==Regra.IMEDIATA?(this.tonicidade=Regra.TIPOS.POSTONICAIMEDIATA,t+=1):c==Regra.POSTONICA?(this.tonicidade=Regra.TIPOS.POSTONICANAOIMEDIATA,t+=1):this.tonicidade=Regra.TIPOS.POSTONICA}else this.tonicidade=Regra.TIPOS.POSTONICA;break;case Regra.ANY_QTY_CHAR:case Regra.ONE_MORE_CHAR:a+=i;break;case Regra.SILABA_CHAR:a+=Cadeia.SILABA_CHAR,this.patternCore+=Cadeia.SILABA_CHAR;break;case Regra.EMPTY_CHAR:default:a+=i,this.patternCore+=i}}this.regex=new RegExp(a,"i"),this.destino=r.replace(new RegExp("\\"+Regra.SILABA_CHAR,"g"),Cadeia.SILABA_CHAR)}function inserirCaracter(e){var r=$("#input"),a=r.textrange().position,t=r.val().slice(0,a),i=r.val().slice(a);r.val(t+$(e).text()+i),r.textrange("setcursor",a+1)}function loadRegras(){for(var e=0;numSincronias>e;e++){var r="s"+e;getFileFromServer("regras/"+r+".txt",fillTextArea,"#"+r)}getFileFromServer("regras/conjuntos.txt",fillTextArea,"#conjuntos"),getFileFromServer("regras/ortografico-fonetico.txt",fillTextArea,"#orto2fone"),getFileFromServer("regras/fonetico-ortografico.txt",fillTextArea,"#fone2orto"),getFileFromServer("ajuda.txt",fillText,"#helpModal-text")}function fillTextArea(e,r){null===e?console.log("Erro ao ler arquivo."):$(r).val(e)}function appendHTML(e,r){if(null===e)console.log("Erro ao ler arquivo.");else{{$.parseHTML(e)}$(r).append()}}function storeRegras(e,r){null===e?console.log("Erro ao ler arquivo."):r.push.apply(r,parseRegras(e))}function lerRegras(){_sincronias=[];for(var e=0;numSincronias>e;e++){var r="s"+e,a=$("#"+r).val(),t=parseRegras(a);_sincronias.push(t)}_regrasOrto2Fone=parseRegras($("#orto2fone").val()),_regrasFone2Orto=parseRegras($("#fone2orto").val())}function parseRegras(e){for(var r={},a=new RegExp("[ \\[\\]\r\n]","g"),t=e.split("\n"),i=0;i<t.length;i++){var n=t[i].replace(a,"");if(n&&0!==n.length){var o,s=n.split(">");2==s.length?o=new Regra(s[0],s[1]):1==s.length&&(o=new Regra(s[0],"")),o.origem in r?r[o.origem].push(o):r[o.origem]=[o]}}var g=[];for(var l in r)g.push(r[l].length>1?new RegraAmbigua(r[l]):r[l][0]);return g}function lerConjuntos(){_conjuntos={};for(var e=new RegExp("[ {}]","g"),r=$("#conjuntos").val().split("\n"),a=0;a<r.length;a++){var t=r[a].replace(e,"").split("=");2==t.length&&(_conjuntos[t[0]]=t[1].split(","))}}function transformar(e,r){for(var a=[r],t=0;t<e.length;t++){for(var i=[],n=0;n<a.length;n++){var o=e[t].aplicar(a[n]);i=i.concat(o)}a=i}return a}function aplicarRegras(){lerConjuntos(),lerRegras();var e=$("input").val().trim().toLowerCase();console.log("Input: "+e);var r=Silabas.encontrarTonica(Silabas.separar(e)),a=new Cadeia(r),t=transformar(_regrasOrto2Fone,a);showInputs(a,t,r);for(var i=t,n=[],o=0;o<t.length;o++)n.push("*["+t[o].toString()+"]");for(var s=0;s<_sincronias.length;s++){console.log("------ Sincronia "+s+" ------");for(var g=_sincronias[s],l=[],c=[],o=0;o<i.length;o++){for(var h=[i[o]],A=0;A<g.length;A++){for(var u=g[A],I=[],R=0;R<h.length;R++){var T=u.aplicar(h[R]);I=I.concat(T)}h=I}l=l.concat(h);for(var R=0;R<h.length;R++)c.push(n[o].concat(" > *[",h[R].toString(),"]"))}i=l,n=c}for(var p=[],o=0;o<i.length;o++)p.push(transformar(_regrasFone2Orto,i[o]));for(var f="",O="",R=0;R<n.length;R++){f+=n[R]+"\n";for(var o=0;o<p[R].length;o++)o>0&&(O+=", "),O+=p[R][o].imprimir();O+="\n"}$("#fulloutput").text(f),$("#fulloutput").html($("#fulloutput").html().replace(/\n/g,"<br/>")),$("#output").text(O),$("#output").html($("#output").html().replace(/\n/g,"<br/>"))}function showInputs(e,r,a){$("#input-ortografico").text(e.str);for(var t="",i=0;i<r.length;i++)t+="["+r[i].imprimir()+"]",i<r.length-1&&(t+=", ");$("#input-fonetico").text(t);for(var n="",i=0;i<a.length;i++)a[i].tonica&&(n+=Silabas.acentoTonico),n+=a[i].str,i<a.length-1&&(n+="-");$("#input-silabas").text(n)}RegraAmbigua.prototype.aplicar=function(e){for(var r=[],a=0;a<this.regras.length;a++)r[a]=this.regras[a].aplicar(e);var t=r.filter(function(e,r,a){for(var t=r+1;t<a.length;t++)if(e.equals(a[t]))return!1;return!0});return t.length>1?t:t[0]},Cadeia.EMPTY_CHAR="#",Cadeia.SILABA_CHAR="-",Cadeia.TONICA_CHAR="ˈ",Cadeia.prototype.encontrarSilabaIdx=function(e){for(var r=0,a=0;e>=a&&a<this.str.length;a++)this.str[a]==Cadeia.SILABA_CHAR&&r++;return r},Cadeia.prototype.toString=function(){var e=this.str.split(Cadeia.SILABA_CHAR);return e[this.silabaTonicaIdx]=Cadeia.TONICA_CHAR+e[this.silabaTonicaIdx],e.join("").replace(new RegExp("[#-]","gi"),"")},Cadeia.prototype.equals=function(e){return this.str==e.str},Cadeia.prototype.imprimir=function(){return this.str.replace(new RegExp("[#-]","gi"),"")},Silaba.prototype.toString=function(){return this.str};var Silabas=Silabas||{};Silabas.acentoTonico="ˈ",Silabas.regexV=new RegExp("(ae|oe|au|æ|œ|a|e|i|o|u|y|ā|ă|ē|ĕ|ī|ĭ|ō|ŏ|ū|ŭ)","gi"),Silabas.regexCC=new RegExp("(pl|pr|bl|br|tl|tr|dl|dr|cl|cr|gl|gr|ph|ch|th|rh|ps)","gi"),Silabas.regexMacron=new RegExp("(ā|ē|ī|ō|ū)","gi"),Silabas.regexBraquia=new RegExp("(ă|ĕ|ĭ|ŏ|ŭ)","gi"),Silabas.separar=function(e){var r=[],a=e.split(Silabas.regexV);if(a.length<=2)r.push(e);else for(var t=a[0]+a[1],i=!1,n=2;n<a.length;n+=2){if(n>=a.length-1){r.push(t+a[n]);break}if(!i&&t.search(new RegExp("(gu|qu)","gi"))>-1&&0==a[n].length)t+=a[n]+a[n+1],i=!0;else{var o=a[n];if(o.length<=1)r.push(t),i=!1,t=a[n]+a[n+1];else{var s=o.search(Silabas.regexCC);0>s&&(s=o.length-1);var g=o.substr(0,s),l=o.substr(s);r.push(t+g),i=!1,t=l+a[n+1]}}}return r},Silabas.encontrarTonica=function(e){for(var r=0;r<e.length;r++)e[r]=new Silaba(e[r]);if(e.length<1)return e;if(e.length<=2)e[0].tonica=!0;else{var a=e[e.length-2].str;a.search(Silabas.regexMacron)>-1?e[e.length-2].tonica=!0:e[e.length-3].tonica=!0}return e},Regra.EMPTY_CHAR="#",Regra.SILABA_CHAR="$",Regra.CJ_START="{",Regra.CJ_END="}",Regra.ANY_QTY_CHAR="*",Regra.ONE_MORE_CHAR="+",Regra.TONICA="ˈ",Regra.ATONA="º",Regra.PRETONICA="-",Regra.POSTONICA="=",Regra.IMEDIATA="!",Regra.PRETONICAIMEDIATA="-!",Regra.POSTONICAIMEDIATA="=!",Regra.PRETONICANAOIMEDIATA="--",Regra.POSTONICANAOIMEDIATA="==",Regra.TIPOS={QUALQUER:0,ATONA:1,PRETONICA:2,POSTONICA:3,PRETONICAIMEDIATA:4,POSTONICAIMEDIATA:5,PRETONICANAOIMEDIATA:6,POSTONICANAOIMEDIATA:7},Regra.prototype.checarTonicidade=function(e,r){var a=!1;switch(this.tonicidade){case Regra.TIPOS.QUALQUER:a=!0;break;case Regra.TIPOS.ATONA:a=r!=e.silabaTonicaIdx;break;case Regra.TIPOS.TONICA:a=r==e.silabaTonicaIdx;break;case Regra.TIPOS.PRETONICA:a=r<e.silabaTonicaIdx;break;case Regra.TIPOS.POSTONICA:a=r>e.silabaTonicaIdx;break;case Regra.TIPOS.PRETONICAIMEDIATA:a=r+1==e.silabaTonicaIdx;break;case Regra.TIPOS.POSTONICAIMEDIATA:a=r-1==e.silabaTonicaIdx;break;case Regra.TIPOS.PRETONICANAOIMEDIATA:a=r+1<e.silabaTonicaIdx;break;case Regra.TIPOS.POSTONICANAOIMEDIATA:a=r-1>e.silabaTonicaIdx;break;default:a=!0}return a},Regra.prototype.aplicar=function(e){for(var r=e.str,a="",t=e.str.search(this.regex),i=0,n=e.index;t>=0&&i<e.str.length;){a+=r.substring(0,t);var o=r.match(this.regex)[0],s=o.search(this.patternCore),g=e.encontrarSilabaIdx(a.length+s);o=o.slice(0,s+this.patternCore.length),a.length+s>=n&&this.checarTonicidade(e,g)?(a+=o.replace(this.patternCore,this.destino),n=a.length+s+this.patternCore.length,i++):a+=o,r=r.substr(t+o.length),t=r.search(this.regex)}i==e.str.length&&console.error("LOOP INFINITO!! Regra: "+this.toString()+" Input: "+e),a+=r;var l=new Cadeia;return l.str=a,l.silabaTonicaIdx=e.silabaTonicaIdx,i>0&&console.log(this+"	"+l),l},Regra.prototype.toString=function(){return this.origem+" > "+this.destino},String.prototype.cut=function(e,r){return this.substring(0,e)+this.substring(r)};const numSincronias=6;var _sincronias=[],_conjuntos={},_regrasOrto2Fone=[],_regrasFone2Orto=[];